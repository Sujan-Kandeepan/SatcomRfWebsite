@model SatcomRfWebsite.Models.AteOutputTopViewModel

@{
    ViewBag.Title = "ATE Output";
}
<div class="container">

    <div class="page-header"><h1>ATE Data Output</h1></div>
    <div class="row">
        <div class="col-lg-8">
            <div class="display" style="margin-top: -20px; margin-bottom: 30px"><h3>View complete data with the applied filters.</h3></div>
        </div>

        <div class="col-lg-2">
            <button id='testResults' class="btn btn-primary btn-block" type="button" onclick='testResults()'>View Test Results</button>
        </div>

        <script>
            function testResults() {
                //alert(filterToApply);
                var pT = document.URL.substring(document.URL.indexOf("pT") + 3, document.URL.indexOf("mN") - 1);
                var mN = document.URL.substring(document.URL.indexOf("mN") + 3, document.URL.indexOf("ser") - 1);
                var ser = document.URL.substring(document.URL.indexOf("ser") + 4, document.URL.indexOf("testType") - 1);
                var testType = document.URL.substring(document.URL.indexOf("testType") + 9, document.URL.indexOf("tubeName") - 1);
                var tubeName = document.URL.substring(document.URL.indexOf("tubeName") + 9, document.URL.indexOf("opt") - 1);
                var opt = document.URL.substring(document.URL.indexOf("opt") + 4);

                if (document.URL.indexOf("pT") == -1) {
                    location.href = location.origin + "/testsData/TestResults/";
                    return;
                }

                if (mN == "na") {
                    location.href = location.origin + "/testsData/TestResults/" + pT;
                    return;
                }

                location.href = location.origin + "/testsData/TestResults/" + pT + "/" + mN + "/testType=" + (testType == "na" ? "none" : testType) + "+tubeName=" + (tubeName == "na" ? "none" : tubeName) + "+opt=" + (opt == "na" ? "none" : opt);
            }
        </script>


        <div class="col-lg-2">
            <button id='filterReset' class="btn btn-block" type="button" onclick='resetFilter()'>Reset Filter</button>
        </div>

        <script>
            $(document).ready(function () {
                if (noSearchCriteria) {
                    $('#filterReset').prop('disabled', false); //true);
                    $('#filterApply').prop('disabled', false); //true);
                } else {
                    $('#filterReset').prop('disabled', false);
                    $('#filterApply').prop('disabled', false);
                }

                $("button").click(function () {
                    //$("#filterReset").html('Please Wait');
                    $body = $("body");
                    $body.addClass("loading");
                });
            });

            $(document).on({
                //ajaxStart: function () { $body.addClass("loading"); },
                //ajaxStop: function () { $body.removeClass("loading"); }
            });

            function resetFilter() {
                //location.href = document.location.origin + "/ateData/AteOutput";
                location.href = document.URL.replace(/AteOutput\?[a-zA-Z0-9=+,-\\%]*/, "AteOutput");
            }
        </script>
    </div>

    <script type="text/javascript">

        var arrProdType         = [@Html.Raw(Model.ateOutputModel.prodTypeStrList)];
        var arrModelName        = [@Html.Raw(Model.ateOutputModel.modelNameStrList)];
        var arrSerialNum        = [@Html.Raw(Model.ateOutputModel.serialNumStrList)];

        //alert(arrProdType.length + " " + arrModelName.length + " " + arrSerialNum.length);

        var noSearchCriteria    = true;
        var filterToApply       = "?filter=pT=na%mN=na%ser=na%testType=na%tubeName=na%opt=na";

        if ("@Model.ateOutputModel.filter" != "") {
            filterToApply = "?filter=@Model.ateOutputModel.filter";
        }

        if (document.URL.indexOf("pT=na%mN=na%ser=na%testType=na%tubeName=na%opt=na") !== -1) {
            Model.ateOutputModel.filter = "";
            location.replace(/AteOutput\?[a-zA-Z0-9=+,-\\%]*/, "AteOutput");
        }

    </script>

    <div class="row">
        <div class="col-lg-2">
            <select id="selectProductType" class="demo-default" placeholder="Product Types...">
                <option value="">Product Types...</option>
                @foreach (var itemProd in Model.ateOutputModel.prodList)
                {
                    <option value="@itemProd" @(Model.ateOutputModel.productType == itemProd ? "selected" : "")>@itemProd</option>
                }
            </select>

            <script>

                $(document).ready(function () {

                    $('#selectProductType').selectize({
                        sortField: {
                            field: 'text',
                            direction: 'asc'
                        },
                        dropdownParent: 'body',
                        onChange: function (value) {

                            if (value == "") { value = "na"; }

                            //indexOf return num > -1 if it finds the string
                            if (document.URL.indexOf("pT=") > -1) {
                                filterToApply = document.URL;
                            }
                            filterToApply = filterToApply.replace(/pT=[a-zA-Z]*/, "pT=" + value);
                            filterToApply = filterToApply.replace(/mN=[a-zA-Z0-9-]*/, "mN=na");
                            filterToApply = filterToApply.replace(/ser=[a-zA-Z0-9_-]*/, "ser=na");
                            location.href = filterToApply;
                        }
                    });
                });

            </script>
        </div>

        <div class="col-lg-2">
            <select id="selectModelName" class="demo-default" placeholder="Model Names..." name="ModelName">
                <option value="">Model Names...</option>
                @foreach (var itemModel in Model.ateOutputModel.modelList)
                {
                    <option value="@itemModel" @(Model.ateOutputModel.modelName == itemModel ? "selected" : "")>@itemModel</option>
                }
            </select>

            <script>

		        $(document).ready(function () {

		            $('#selectModelName').selectize({
		                sortField: {
		                    field: 'text',
		                    direction: 'asc'
		                },
		                dropdownParent: 'body',
		                onChange: function (value) {

		                    var prod = "@Model.ateOutputModel.productType"; //"na";

		                    // trying to figure out what is the product type if we do the search by modelName
		                    if (value != "") {
		                        for (i = 0; i < arrModelName.length; i++) {
		                            if (value == arrModelName[i]) {
		                                prod = arrProdType[i];
		                                break;
		                            }
		                        }
		                    }
		                    //indexOf return num > -1 if it finds the string
		                    if (document.URL.indexOf("mN=") > -1) {
		                        filterToApply = document.URL;
		                    }
		                    if (value != "") { filterToApply = filterToApply.replace(/pT=[a-zA-Z]*/, "pT=" + prod); }
		                    filterToApply = filterToApply.replace(/mN=[a-zA-Z0-9-]*/, "mN=" + value);
		                    filterToApply = filterToApply.replace(/ser=[a-zA-Z0-9_-]*/, "ser=na");
		                    location.href = filterToApply;
		                }
		            });
		        });

            </script>
        </div>
        <div class="col-lg-2">
            <select id="selectSerialNum" class="demo-default" placeholder="Serial Nums..." name="SerialNum">
                <option value="">Serial Nums...</option>
                @foreach (var itemSN in Model.ateOutputModel.serList)
                {
                    <option value="@itemSN" @(Model.ateOutputModel.serialNum == itemSN ? "selected" : "")>@itemSN</option>
                }
            </select>

            <script>

		        $(document).ready(function () {

		            $('#selectSerialNum').selectize({
		                sortField: {
		                    field: 'text',
		                    direction: 'asc'
		                },
		                dropdownParent: 'body',
		                onChange: function (value) {

		                    var prod = "@Model.ateOutputModel.productType";// "na";
		                    var model = "@Model.ateOutputModel.modelName";// "na";

		                    // trying to figure out what is the model name and product type if we do the search by serial
                            if (value != "") {
		                        for (i = 0; i < arrSerialNum.length; i++) {
		                            if (value == arrSerialNum[i]) {
		                                prod = arrProdType[i];
		                                model = arrModelName[i];
		                                break;
		                            }
		                        }
                            }
		                    //indexOf return num > -1 if it finds the string
		                    if (document.URL.indexOf("ser=") > -1) {
		                        filterToApply = document.URL;
		                    }
		                    filterToApply = filterToApply.replace(/pT=[a-zA-Z]*/, "pT=" + prod);
		                    filterToApply = filterToApply.replace(/mN=[a-zA-Z0-9-]*/, "mN=" + model);
		                    filterToApply = filterToApply.replace(/ser=[a-zA-Z0-9_-]*/, "ser=" + value);
		                    location.href = filterToApply;
		                }
		            });
		        });

            </script>
        </div>
        <div class="col-lg-6"></div>

        <!-----------------------------  FILTER ------------------------------->

        <div class="col-lg-2">
            <select id="selectTestType" class="demo-default" placeholder="Test Type...">
                <option value="">Test Type ...</option>
                <option value="ProdTest" @(Model.ateOutputModel.testType == "ProdTest" ? "selected" : "")>Production Test</option>
                <option value="EngTest" @(Model.ateOutputModel.testType == "EngTest" ? "selected" : "")>Engineering Test</option>
                <option value="Debug" @(Model.ateOutputModel.testType == "Debug" ? "selected" : "")>Debugging</option>
            </select>

            <script>

		        $(document).ready(function () {

		            var testTypePassedIn = "@Model.ateOutputModel.testType";

		            //alert("@Model.ateOutputModel.testType" + " " + "@Model.ateOutputModel.tubeName" + " " + "@Model.ateOutputModel.options");

		            //select by typing
		            $('#selectTestType').selectize({
		                sortField: {
		                    field: 'text',
		                    direction: 'asc'
		                },
		                dropdownParent: 'body',
		                onChange: function (value) {

		                    if (document.URL.search("testType=") > -1) {
		                        location.href = document.URL.replace(/testType=[a-zA-Z]*/, "testType=" + value);
                            } else {
		                        location.href = filterToApply.replace(/testType=[a-zA-Z]*/, "testType=" + value);
                            }
		                }
		            });
		        });

            </script>
        </div>

        <div class="col-lg-2">
            <select id="selectTubeName" class="demo-default" placeholder="Tube Name...">
                <option value="">Tube Name...</option>
                @foreach (var tube in Model.ateOutputModel.tubeList)
                {
                    <option value="@tube" @(Model.ateOutputModel.tubeName == tube ? "selected" : "")>@tube</option>
                }
            </select>

            <script>

                $(document).ready(function () {

                    //select by typing
                    $('#selectTubeName').selectize({
                        sortField: {
                            field: 'text',
                            direction: 'asc'
                        },
                        dropdownParent: 'body',
                        onChange: function (value) {
                            if (document.URL.search("tubeName=") > -1) {
                                location.href = document.URL.replace(/tubeName=[a-zA-Z0-9-]*/, "tubeName=" + value);
                            } else {
                                location.href = filterToApply.replace(/tubeName=[a-zA-Z0-9-]*/, "tubeName=" + value);
                            }
                        }
                    });
                });

            </script>
        </div>

        <div class="col-lg-2">
            <select id="selectOptions" multiple class="demo-default" placeholder="Select Options...">
                <option value="">Select Options...</option>
                <option value="Audit" @(Model.ateOutputModel.options.Contains("Audit") ? "selected" : "")>Audit</option>
                <option value="SsaSN" @(Model.ateOutputModel.options.Contains("SsaSN") ? "selected" : "")>SSA</option>
                <option value="LinSN" @(Model.ateOutputModel.options.Contains("LinSN") ? "selected" : "")>LIN</option>
                <option value="LipaSN" @(Model.ateOutputModel.options.Contains("LipaSN") ? "selected" : "")>LIPA</option>
                <option value="BucSN" @(Model.ateOutputModel.options.Contains("BucSN") ? "selected" : "")>BUC</option>
                <option value="BipaSN" @(Model.ateOutputModel.options.Contains("BipaSN") ? "selected" : "")>BIPA</option>
                <option value="BlipaSN" @(Model.ateOutputModel.options.Contains("BlipaSN") ? "selected" : "")>BLIPA</option>
            </select>

            <script>

                $(document).ready(function () {

                    //select by typing
                    $('#selectOptions').selectize({
                        plugins: ['remove_button'],
                        delimiter: ',',
                        persist: false,
                        onChange: function (value) {
                            if (value == null) { value = "na"; }
                            if (document.URL.search("opt=") > -1) {
                                location.href = document.URL.replace(/opt=[a-zA-Z,]*/, "opt=" + value);
                            } else {
                                location.href = filterToApply.replace(/opt=[a-zA-Z,]*/, "opt=" + value);
                            }
                        }
                    });
                });

            </script>
        </div>
        <div class="col-lg-6"></div>
    </div>


    <!---------------------------- FILTER END ------------------------------>

    <div class="row"><hr /></div>
    <table id="table_id_1" class="display">

        <thead>
            <tr>
                <th>StartTime</th>
                <th>Serial#</th>
                <th>Audit</th>
                <th>Long Model Name</th>
                <th>Tube Name</th>
                <th>SsaSN</th>
                <th>LinSN</th>
                <th>LipaSN</th>
                <th>BucSN</th>
                <th>BipaSN</th>
                <th>BlipaSN</th>
            </tr>
        </thead>
        <tbody>

            @{
                var yscroll = 50;
                var numAteTests = 0;

                if (Model.ateOutputModel.ateOutputList.Count > 0)
                {
                    foreach (var item in Model.ateOutputModel.ateOutputList)
                    {
                        <tr>
                            <td>@Html.DisplayFor(modelItem => item.startTime)</td>
                            <td><a href='~/ateData/AteOutputDetail/?serNum=@item.serialNum'>@Html.DisplayFor(modelItem => item.serialNum)</a></td>
                            <td>@Html.DisplayFor(modelItem => item.audit)</td>
                            <td>@Html.DisplayFor(modelItem => item.longModelName)</td>
                            <td>@Html.DisplayFor(modelItem => item.tubeName)</td>
                            <td>@Html.DisplayFor(modelItem => item.ssaSN)</td>
                            <td>@Html.DisplayFor(modelItem => item.linSN)</td>
                            <td>@Html.DisplayFor(modelItem => item.lipaSN)</td>
                            <td>@Html.DisplayFor(modelItem => item.bucSN)</td>
                            <td>@Html.DisplayFor(modelItem => item.bipaSN)</td>
                            <td>@Html.DisplayFor(modelItem => item.blipaSN)</td>
                        </tr>
                        numAteTests++;
                    }

                    if (numAteTests < 5) { yscroll = 250; }
                    else { yscroll = 500; }
                }
            }
        </tbody>
    </table>

    <script>
        $(document).ready(function () {
            $('#table_id_1').DataTable({
                "scrollX": true,
                "scrollY": @yscroll
            });
        });

        //Set navbar button as active
        document.getElementById("navBarAteOutput").classList.add("active");
    </script>

</div>